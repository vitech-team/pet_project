language: java
jdk: oraclejdk8

branches:
  only:
  - master

before_script:
- chmod +x ./gradlew

build:
  cache: true
  cache_dir_list:
  - $HOME/.gradle/
  - $SHIPPABLE_BUILD_DIR/dev-flow-sample-ui/node_modules/

  pre_ci_boot:
    image_name: vitechpetproject/ci
    image_tag: 0.1.4
    pull: true

  ci:
  - ./gradlew clean build jacocoRootReport sonarqube buildDockerImage -Dsonar.pullrequest.base=$PULL_REQUEST_BASE_BRANCH  -Dsonar.pullrequest.branch=$HEAD_BRANCH -Dsonar.pullrequest.key=$TRAVIS_PULL_REQUEST

  always:
  - cp -r ./**/build/test-results/test/* shippable/testresults
  - cp -r ./build/target shippable/codecoverage
  - cp -r ./dev-flow-sample-ui/coverage/cobertura-coverage.xml shippable/codecoverage
  - cp -r ./dev-flow-sample-ui/coverage/junit.xml shippable/testresults


integrations:
  hub:
  - integrationName: DockerHub
    type: dockerRegistryLogin

  notifications:
  - integrationName: Slack   
    type: slack
    recipients:
      - "#elligo-tech-space"
